<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Okinawa Trip Planner</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#f06292" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Okinawa Trip" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #ec407a;
      --primary-dark: #d81b60;
      --bg: #fef4f8;
      --card-bg: #ffffff;
      --text-main: #212121;
      --text-sub: #757575;
      --radius-xl: 18px;
      --shadow-soft: 0 10px 24px rgba(233, 30, 99, 0.18);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffe3f0 0, #fef4f8 45%, #ffffff 100%);
      color: var(--text-main);
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 18px 20px 14px;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: white;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 6px 18px rgba(233, 30, 99, 0.35);
      border-radius: 0 0 24px 24px;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.04em;
      font-family: "Pacifico", cursive;
    }
    header .subtitle {
      font-size: 13px;
      opacity: 0.92;
      margin-top: 4px;
    }
    .day-tabs-wrap {
      padding: 10px 16px 4px;
      position: sticky;
      top: 72px;
      z-index: 9;
    }
    .day-tabs {
      display: flex;
      gap: 8px;
      background: rgba(255,255,255,0.9);
      padding: 6px;
      border-radius: 999px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
    }
    .day-tab {
      flex: 1;
      padding: 8px 0;
      border-radius: 999px;
      border: 0;
      background: transparent;
      color: var(--primary-dark);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }
    .day-tab span { display: block; font-size: 11px; opacity: 0.8; }
    .day-tab strong { display: block; font-size: 13px; }
    .day-tab.active {
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(233, 30, 99, 0.55);
    }
    main { flex: 1; padding: 16px 14px 32px; }
    .day-title {
      font-size: 15px;
      font-weight: 600;
      margin: 4px 4px 10px;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* ? info 頁：統一卡片尺寸 */
.info-page .info-card {
  padding: 14px 16px;
  min-height: 56px;
  border-radius: 18px;
}
    /* ? info 頁：統一右側箭頭樣式 */
.info-page .chev {
  font-size: 14px;
  margin-left: 8px;
  color: rgba(216, 27, 96, 0.75);
}
    .info-page .right-top {
  align-items: center;
}
    .info-page .category-chip {
  height: 22px;
  display: flex;
  align-items: center;
}
    .day-title span { font-size: 12px; opacity: 0.9; }
    .timeline { position: relative; margin-left: 10px; padding-left: 12px; }
/* ? info 頁：隱藏左側時間軸線，讓卡片對齊 */
.info-page .timeline::before {
  display: none;
}
    .timeline::before {
      content: "";
      position: absolute;
      left: 4px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, rgba(236,64,122,0.1), rgba(236,64,122,0.35));
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }
    .card::before {
      content: "";
      position: absolute;
      left: -40px;
      top: -40px;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: radial-gradient(circle at center, rgba(236,64,122,0.18), transparent 65%);
      opacity: 0.7;
    }
    .dot {
      position: absolute;
      left: -18px;
      top: 16px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 2px solid #ffffff;
      background: var(--primary);
      box-shadow: 0 0 0 4px rgba(236,64,122,0.25);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }
    .time { font-size: 11px; color: var(--text-sub); margin-bottom: 4px; }
    .title { font-size: 15px; font-weight: 700; margin-bottom: 2px; }
    .right-top { display:flex; align-items:center; gap:8px; }
    .category-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(236,64,122,0.06);
      color: var(--primary-dark);
      border: 1px solid rgba(236,64,122,0.25);
      margin-top: 2px;
      white-space: nowrap;
    }
    .chev {
      font-size: 14px;
      color: rgba(216,27,96,0.75);
      transition: transform 0.18s ease;
    }
    .card.collapsed .chev { transform: rotate(-90deg); }
    .detail { margin-top: 10px; }
    .card.collapsed .detail { display: none; }
    .note {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 8px;
      line-height: 1.5;
      white-space: pre-line;
    }
    .card-footer {
      display: flex;
      align-items: center;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-sub);
      gap: 8px;
      flex-wrap: wrap;
    }
    .cost { font-weight: 500; margin-right: auto; white-space: pre-line; }
    .link-wrap { display: flex; gap: 8px; flex-wrap: wrap; }
    .btn-link {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 0;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(233,30,99,0.35);
      white-space: nowrap;
    }
    .btn-link:disabled {
      opacity: 0.4;
      box-shadow: none;
      cursor: default;
      background: #e0e0e0;
      color: #757575;
    }
    .empty {
      text-align: center;
      color: var(--text-sub);
      margin-top: 40px;
      font-size: 14px;
    }

    /* ? PWA 安裝按鈕（Android Chrome） */
    .install-btn {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 9999;
      padding: 12px 14px;
      border-radius: 999px;
      border: 0;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      font-weight: 800;
      box-shadow: 0 10px 24px rgba(233, 30, 99, 0.28);
      cursor: pointer;
      white-space: nowrap;
    }
    .install-btn[hidden] { display: none; }
    .install-btn:disabled { opacity: 0.55; cursor: default; }
  
    /* ? 準備物品清單（info頁） */
    .checklist-panel { margin: 8px 4px 14px; }
    .checklist-card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
    }
    .checklist-title { font-size: 15px; font-weight: 800; margin: 0 0 8px; }
    .checklist-sub { font-size: 12px; color: var(--text-sub); margin-bottom: 10px; line-height: 1.35; }
    .checklist-row { display:flex; align-items:center; gap:10px; padding: 8px 0; border-top: 1px solid rgba(0,0,0,0.06); }
    .checklist-row:first-of-type { border-top: 0; }
    .checklist-row label { flex: 1; font-size: 13px; }
    .checklist-actions { display:flex; gap:8px; flex-wrap: wrap; margin-top: 10px; }
    .checklist-input { flex: 1; min-width: 180px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.12); outline: none; }
    .btn-ghost {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(236,64,122,0.35);
      background: rgba(236,64,122,0.06);
      color: var(--primary-dark);
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-ghost:active { transform: translateY(1px); }
    .btn-danger {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(244,67,54,0.35);
      background: rgba(244,67,54,0.06);
      color: #c62828;
      cursor: pointer;
      white-space: nowrap;
    }
/* ? info 頁：統一卡片尺寸（放在 CSS 最後，蓋過 .card） */
.info-page .card.info-card{
  padding: 14px 16px;
  min-height: 56px;
  border-radius: 18px;
}

/* ? info 頁：右側 chip + 箭頭對齊 */
.info-page .card.info-card .right-top{ align-items: center; }
.info-page .card.info-card .category-chip{
  height: 22px;
  display: inline-flex;
  align-items: center;
  margin-top: 0;
}
.info-page .card.info-card .chev{
  font-size: 14px;
  margin-left: 8px;
}

/* ? info 頁：真的對齊（去掉左邊軸線 + 左邊空間 + 圓點） */
.info-page .timeline{ margin-left: 0; padding-left: 0; }
.info-page .timeline::before{ display: none; }
.info-page .dot{ display: none; }

  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Okinawa Trip</h1>
      <div class="subtitle">沖繩衝衝衝</div>
    </header>

    <div class="day-tabs-wrap">
      <div class="day-tabs" id="dayTabs"></div>
    </div>

    <main id="mainContent" class="info-page">
      <div class="day-title" id="dayTitle"></div>
      <div class="checklist-panel" id="checklistPanel" style="display:none;"></div>
      <div class="timeline" id="cardContainer"></div>
      <div class="empty" id="emptyState" style="display:none;">這一天還沒有安排行程</div>
    </main>
  </div>

  <!-- ? 安裝按鈕（可安裝時才會顯示） -->
  <button id="installBtn" class="install-btn" hidden>?? 安裝 App</button>

  <script>
/**
 * ? 連結自由命名規則（你只要改這裡）
 * link 可以是：
 * 1) 字串（可用 \\n 放多個網址）=> 會自動產生「icon + 網站名」
 * 2) 陣列 [{ label, url }, ...] => 你給什麼名字就顯示什麼名字（icon 你也可以自己寫進 label）
 */
const schedule = [
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "13:25–15:55（2小時30分 時差1小時）",
    title: "桃機T1??那霸機場",
    category: "交通",
    note: "AirAsia FD230\n手提7kg*3 託運20kg*2\n國際線4F或是國內線1F有豬肉蛋飯糰",
    cost: "已付 18,262 NTD (來回)",
    link: [
      { label: "?? Visit Japan Web", url: "https://services.digital.go.jp/zh-cmn-hant/visit-japan-web/" },
      { label: "?? 豬肉蛋飯糰介紹", url: "https://hanblog.tw/porktamago/" }
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "15:55–17:55（2小時）",
    title: "那霸機場??租車公司",
    category: "交通",
    note: "入境審查 + 租車公司接送 + 租車\n行腳租車 (Pin code : 63512871)\n<<如果時間夠早，放棄漁師食堂，走 ?Plan B>>",
    cost: "未付 18.090?\n已付  2,010?",
    link: [
      { label: "?Plan B", toDay: "info" },
      { label: "?? 接駁車位置", url: "https://youtube.com/watch?v=iAl8v1AAcjM&embeds_referring_euri=https%3A%2F%2Ffootprint-rentacar.com%2F&source_ve_path=OTY3MTQ/" },
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "17:55–18:25（30分）",
    title: "??",
    category: "交通",
    note: "租車公司 -> 漁師食堂 大??????舞 ???大統",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Okinawaangya+Car+Rental,+3+Chome-8-11+Kanagusuku,+Naha,+Okinawa+901-0155%E6%97%A5%E6%9C%AC/Ryoshi+Shokudo+Obanburumai+Sakana+Daitoryo,+3+Chome-1-17+Minatomachi,+Naha,+Okinawa+900-0001%E6%97%A5%E6%9C%AC/@26.2267077,127.7007522,13.42z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e569dca4935975:0xf7655eeca9dc26ba!2m2!1d127.6621154!2d26.2011231!1m5!1m1!1s0x34e56b047c4b65c9:0x3e70d1280ee22c7a!2m2!1d127.6803223!2d26.2436476!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "18:25–19:25（1小時）",
    title: "晚餐",
    category: "用餐",
    note: "漁師食堂 大??????舞 ???大統\n大份量丼飯/鰻魚飯",
    cost: "",
    link: [
      { label: "?? 餐廳介紹", url: "https://plumpyblog.com/ryoshi-shokudo/" },
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "19:25–20:05（40分）",
    title: " ??",
    category: "交通",
    note: "晚餐 -> sunset beach hotel (含早餐)",
    cost: "已付 4,420 NTD",
    link: [
      { label: "??? 飯店", url: "https://beachmonpa.co.jp/" },
      { label: "?? google map", url: "https://www.google.com/maps/dir/Ryoshi+Shokudo+Obanburumai+Sakana+Daitoryo,+3+Chome-1-17+Minatomachi,+Naha,+Okinawa+900-0001%E6%97%A5%E6%9C%AC/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/@26.2790994,127.6809087,13z/data=!3m2!4b1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m14!4m13!1m5!1m1!1s0x34e56b047c4b65c9:0x3e70d1280ee22c7a!2m2!1d127.6803223!2d26.2436476!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "20:05–21:25（1小時20分）",
    title: "飯店 checkin + 美國村逛街",
    category: "購物",
    note: "",
    cost: "",
    link: [
    { label: "??? 逛街攻略1", url: "https://www.gltjp.com/zh-hant/article/item/21095/" },
    { label: "??? 逛街攻略2", url: "https://bobbyfun.tw/2024-01-08-2709/" },
    { label: "??? 逛街攻略3", url: "https://okinawa.letsgojp.com/archives/11334/" },
    ],
  },
  {
    day: "D1",
    label: "D1 · 1/9",
    time: "21:25–22:55（1小時30分）",
    title: "AEON 北谷",
    category: "購物",
    note: "媽媽時間\n超市到 23:00 商店到22:00",
    cost: "",
     link: [
    { label: "??? 逛街攻略", url: "https://bobowin.blog/aeon-american/" },
    ],
  }, 
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "08:30–09:00（30分）",
    title: "飯店",
    category: "用餐",
    note: "飯店早餐",
    cost: "",
    link: [
      { label: "??? 飯店", url: "https://beachmonpa.co.jp/" },
      ],
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "09:00–09:30（30分）",
    title: "??",
    category: "交通",
    note: "飯店 -> 沖繩兒童王國",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Goya,+5+Chome%E2%88%927+%E6%B2%96%E7%B9%A9%E5%85%92%E7%AB%A5%E7%8E%8B%E5%9C%8B/@26.316697,127.7690274,15z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e512738000a60d:0x8be494fd3bd9ee0b!2m2!1d127.80304!2d26.327691!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "09:30–12:30（3小時）",
    title: "沖繩兒童王國",
    category: "景點",
    note: "平日營業時間 : 9:30-17:30\n假日營業時間 : 9:30-21:00",
    cost: "未付 成人 1,000? / 小孩 free",
    link: [
      { label: "?? 兒童王國", url: "https://www.okzm.jp/information-cht/" },
      ],
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "12:30–13:00（30分）",
    title: "??",
    category: "交通",
    note: "沖繩兒童王國 -> 美國村",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Goya,+5+Chome%E2%88%927+%E6%B2%96%E7%B9%A9%E5%85%92%E7%AB%A5%E7%8E%8B%E5%9C%8B/@26.316697,127.7690274,15z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e512738000a60d:0x8be494fd3bd9ee0b!2m2!1d127.80304!2d26.327691!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },

  {
    day: "D2",
    label: "D2 · 1/10",
    time: "13:00–14:30（1小時30分）",
    title: "美國村午餐",
    category: "用餐",
    note: "AI 推薦 :  ???????四季（Sunabe）-鐵板牛排\nAI 推薦 :  鳥?卵??門店 鳥玉（北谷店）- 親子丼、玉子燒、咖哩\nAI 推薦 :  ????????（美國村) - 美式餐廳",
    cost: "",
    link: [
      { label: "??? 美食推薦", url: "https://tw.tabiiro.travel/gourmet/article/americanvillage-gourmet/" },
    ]
  },

  
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "14:30–16:30（2小時）",
    title: "飯店休息",
    category: "休息",
    note: "充電時間/媽媽自由時間",
    cost: "",
    link: "",
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "16:30–17:10（40分）",
    title: "??",
    category: "交通",
    note: "飯店 -> 東南植物樂園",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+8-11+Mihama,+Chatan,+Nakagami+District,+Okinawa+904-0115%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Chibana,+%E6%9D%B1%E5%8D%97%E6%A4%8D%E7%89%A9%E6%A8%82%E5%9C%92/@26.3421377,127.7550494,13.5z/data=!4m14!4m13!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e511d8db9268d7:0x97aa9da99ec7390b!2m2!1d127.8065709!2d26.3755374!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "17:10–19:40（2小時30分）",
    title: "東南植物樂園",
    category: "景點",
    note: "當日成人節活動，僅售一日票 \n火焰與光之舞台-雷射火焰秀 : 18:30",
    cost: "未付 成人 2850?/小孩 1200?",
    link: [
    { label: "?? 景點資訊", url: "https://www.southeast-botanical.jp/christmas_newyear/" },
    ]
  },
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "19:40–20:20（40分）",
    title: "??",
    category: "交通",
    note: "東南植物樂園 -> 美國村\n公共停車場 前兩小時免費",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Chibana,+%E6%9D%B1%E5%8D%97%E6%A4%8D%E7%89%A9%E6%A8%82%E5%9C%92/Kitatanifissharina+Dai+2+Kokyo+Parking+Lot,+36+Mihama,+Chatan,+Nakagami+District,+Okinawa+904-0115%E6%97%A5%E6%9C%AC/@26.3293702,127.7574764,15.75z/data=!4m14!4m13!1m5!1m1!1s0x34e511d8db9268d7:0x97aa9da99ec7390b!2m2!1d127.8065709!2d26.3755374!1m5!1m1!1s0x34e513681979367b:0xb5c105ff569d5315!2m2!1d127.754586!2d26.320947!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  
  {
    day: "D2",
    label: "D2 · 1/10",
    time: "20:30–22:30（2小時00分）",
    title: "美國村晚餐",
    category: "用餐",
    note: "琉球?牛 20:30 \n 預約代碼 : P3F4H3 ",
    cost: "",
    link: [
    { label: "?? 琉球?牛", url: "https://lailai-web.com/ryukyu-no-ushi-chatan/" },
    { label: "?? 預約頁面", url: "https://www.tablecheck.com/zh-TW/reservations/P3F4H3?prev_action=reserve/" },
      
    ]
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "08:30–09:30（1小時）",
    title: "飯店",
    category: "用餐",
    note: "飯店早餐 + check out",
    cost: "",
    link: "",
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "09:30–10:00（30分）",
    title: "??",
    category: "交通",
    note: "飯店 -> 永旺夢樂城",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/AEON+MALL+Okinawa+Rycom,+1%E7%95%AA%E5%9C%B0+Raikamu,+Kitanakagusuku,+Nakagami+District,+Okinawa+901-2306%E6%97%A5%E6%9C%AC/@26.2980708,127.7892839,14.21z/data=!4m14!4m13!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e5126214d2f427:0xcb2e803176e4f16b!2m2!1d127.7966025!2d26.3137504!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "10:00–13:00（3小時）",
    title: "永旺夢樂城",
    category: "購物 + 用餐",
    note: "1F Pokemon, 3COINS+, LOFT\n3F bic camera, ABC-MART",
    cost: "",
     link: [
    { label: "??? Coupon", toDay: "info" }, 
    { label: "??? 退稅", url: "https://www.funliday.com/posts/aeon-mall-okinawa-ryoom/" },
    { label: "??? 商場資訊", url: "https://tw.aeonmall.global/mall/okinawarycom/food-drink/" },
    { label: "??? 逛街攻略", url: "https://bobbyfun.tw/2024-01-07-2699/" },
    { label: "?? 兒童設施", url: "https://boysmom.life/2017-08-24-117/" },     
     ],
  }, 
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "13:00–13:50（50分）",
    title: "??",
    category: "交通",
    note: "永旺夢樂城-> 沖繩世界(玉泉洞)\n小弟睡覺時間",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/AEON+MALL+Okinawa+Rycom,+1%E7%95%AA%E5%9C%B0+Raikamu,+Kitanakagusuku,+Nakagami+District,+Okinawa+901-2306%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E5%8D%97%E5%9F%8E%E5%B8%82+Tamagusuku,+Maekawa+%E7%8E%89%E6%B3%89%E6%B4%9E/@26.2276119,127.6791699,12z/data=!3m1!4b1!4m14!4m13!1m5!1m1!1s0x34e5126214d2f427:0xcb2e803176e4f16b!2m2!1d127.7966025!2d26.3137504!1m5!1m1!1s0x34e56985519f786b:0x5e9a8bdcd64306dd!2m2!1d127.7494344!2d26.1403423!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "13:50–16:50（3小時）",
    title: "沖繩世界(玉泉洞)",
    category: "景點",
    note: "太鼓表演》(1)10:30 (2)12:30 (3)14:30\n毒蛇表演 (1)11:30 (2)13:30 (3)15:30\n辣椒粉必買\n珊瑚烘焙的 35coffee",
    cost: "未付 成人 2,000?, 小孩 1,000?",
        link: [
      { label: "?? 沖繩世界", url: "https://www.google.com/search?q=%E6%B2%96%E7%B9%A9%E4%B8%96%E7%95%8C+%E7%8E%89%E6%B3%89%E6%B4%9E" },
      { label: "? 35 咖啡", url: "https://okinawa.letsgojp.com/archives/23589/" },
    ]
  },
    {
    day: "D3",
    label: "D3 · 1/11",
    time: "16:50–17:00（10分）",
    title: "??",
    category: "交通",
    note: "沖繩世界(玉泉洞) -> costco\n時間足夠可以繞去知念岬公園看海景",
    cost: "",
    link: [
      { label: "?? google map", url: "https://www.google.com/maps/dir/Okinawasoba-Kintarou,+%E3%81%B5%E3%81%AA%E3%81%93%E3%81%97%E3%82%A2%E3%83%91%E3%83%BC%E3%83%88+Funakoshi-1197+Tamagusuku,+Nanjo,+Okinawa+901-0618%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E5%8D%97%E5%9F%8E%E5%B8%82+Tsukishiro,+Kakinohana+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97/@26.1500059,127.7631814,15z/data=!3m1!4b1!4m14!4m13!1m5!1m1!1s0x34e56f12041e81c3:0xb1f12121b0b040c5!2m2!1d127.755329!2d26.1489297!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "17:00–18:30（1小時30分）",
    title: "COSTCO",
    category: "逛街",
    note: "只能現金或是master card\n不能退稅",
    cost: "",
    link: [
      { label: "??? 逛街攻略", url: "https://www.funliday.com/posts/okinawa-costco/" },
    ],
  },
    {
    day: "D3",
    label: "D3 · 1/11",
    time: "18:30–19:30（1小時）",
    title: "??",
    category: "交通",
    note: "COSTCO -> 國際通大和ROYNET酒店\n飯店付費停車場，先到先贏\n星期日 12:00~18:00 國際通步行者天國",
    cost: "",
    link: [
      { label: "??? 飯店", url: "https://www.daiwaroynet.jp/ct/naha-kokusaidori/" },
      { label: "?? google map", url: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E9%82%A3%E9%9C%B8%E5%B8%82+Asato,+2+Chome%E2%88%921+%E9%82%A3%E9%9C%B8%E5%9C%8B%E9%9A%9B%E9%80%9A%E5%A4%A7%E5%92%8CROYNET%E9%A3%AF%E5%BA%97/%E6%97%A5%E6%9C%AC%E3%80%92901-0601+Okinawa,+Nanjo,+Tsukishiro,+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97+IC%E5%8D%97%E5%9C%9F%E5%9C%B0%E5%8C%BA%E7%94%BB%E6%95%B4%E7%90%86%E4%BA%8B%E6%A5%AD%E5%9C%B0%E5%86%851%E8%A1%97%E5%8C%BA1/@26.1663933,127.7473131,14.29z/data=!4m14!4m13!1m5!1m1!1s0x34e5696484d555e5:0xa8fda093394851cc!2m2!1d127.6936214!2d26.2176311!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 · 1/11",
    time: "19:30–21:30（2小時）",
    title: "飯店check in +國際通逛街+晚餐",
    category: "用餐",
    note: "國際通大和ROYNET酒店\n早餐要加購322 NTD/人，兒童免費\nAI推薦 : 花笠食堂 - 家庭式料理\nAI推薦 : 三笠食堂（24 小時) - 在地餐廳",
    cost: "已付 4.227 NTD",
    link: [
    { label: "??? 逛街攻略1", url: "https://bobbyfun.tw/2024-01-08-2708/" },
    { label: "??? 逛街攻略2", url: "https://tc.tabirai.net/sightseeing/article/kokusai-street-shopping//" },
    { label: "?? 美食推薦1", url: "https://www.youtube.com/watch?v=RyfCLurnJNA/" },
    { label: "?? 美食推薦2", url: "https://www.wendyjourney.com/kokusai-dori-food/" },
    ],
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "08:30–09:30（1小時）",
    title: "早餐 + 飯店check out",
    category: "用餐",
    note: "飯店早餐要加購",
    cost: "未付 大人 1,980 ?\n兒童 免費",    
    link: "",
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "09:30–09:45（15分）",
    title: "??",
    category: "交通",
    note: "飯店 > 波上宮",
    cost: "",
    link: [
    { label: "?? google map", url: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E9%82%A3%E9%9C%B8%E5%B8%82+Asato,+2+Chome%E2%88%921+%E9%82%A3%E9%9C%B8%E5%9C%8B%E9%9A%9B%E9%80%9A%E5%A4%A7%E5%92%8CROYNET%E9%A3%AF%E5%BA%97/%E6%97%A5%E6%9C%AC%E3%80%92901-0601+Okinawa,+Nanjo,+Tsukishiro,+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97+IC%E5%8D%97%E5%9C%9F%E5%9C%B0%E5%8C%BA%E7%94%BB%E6%95%B4%E7%90%86%E4%BA%8B%E6%A5%AD%E5%9C%B0%E5%86%851%E8%A1%97%E5%8C%BA1/@26.1663933,127.7473131,14.29z/data=!4m14!4m13!1m5!1m1!1s0x34e5696484d555e5:0xa8fda093394851cc!2m2!1d127.6936214!2d26.2176311!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "09:45–10:45（1小時）",
    title: "波上宮",
    category: "景點",
    note: "",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "10:45–11:00（15分）",
    title: "??",
    category: "交通",
    note: "波上宮 > 那霸港 (海上觀光船Orca號)",
    cost: "",
     link: [
    { label: "?? google map", url: "https://www.google.com/maps/dir/Naminouegusanpaishasenyo+Parking+Lot,+1+Chome-25-10+Wakasa,+Naha,+Okinawa+900-0031%E6%97%A5%E6%9C%AC/Naha+Port+Parking+Lot,+3-2-1+Tondocho,+Naha,+Okinawa+900-0035%E6%97%A5%E6%9C%AC/@26.2156047,127.6652209,16z/data=!3m2!4b1!5s0x34e5696490700691:0x765739d498290581!4m14!4m13!1m5!1m1!1s0x34e569006a4d5495:0xb1be8b57693545a5!2m2!1d127.6712424!2d26.220213!1m5!1m1!1s0x34e56976c5e233f5:0x44e7ba90416bdbc0!2m2!1d127.6703948!2d26.2109788!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "11:00–12:30（1小時30分）",
    title: "海上觀光船Orca號",
    category: "景點",
    note: "11:30 觀光船\n尚未預約",
    cost: "不含餐 : 大人 2,200, 小孩免費 \n 含餐 : 大人 4,500, 小孩 500",
    link: [
    { label: "??? 景點介紹", url: "https://fullfenblog.tw/glass-bottom-boat/" },
    { label: "?? 預約網站", url: "https://tw.westmarine.co.jp/orca_lunch.php" },
    ],
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "12:30–13:45（1小時15分）",
    title: "午餐 + 租車公司還車",
    category: "用餐",
    note: "還車前要加滿油\n選擇一 : 觀光船海鮮丼吃到飽方案(小孩是套餐)\n選擇二 : Nakazaya ???家沖繩麵(租車公司步行4分鐘，行李寄放租車公司?)\n選擇三 : 機場美食",
    link: [
    { label: "? 加油站", url: "https://www.google.com/maps/place/apollostation+Oroku+Kinjo+SS/@26.201515,127.6616106,18.25z/data=!4m10!1m2!2m1!1z5Yqg5rK556uZ!3m6!1s0x34e569b79ed74589:0xae0f20014db85b03!8m2!3d26.2018544!4d127.6622261!15sCgnliqDmsrnnq5laDCIK5Yqg5rK5IOermZIBC2dhc19zdGF0aW9umgEjQ2haRFNVaE5NRzluUzBWSlEwRm5TVU4yT0dGNVkxaDNFQUXgAQD6AQUIogEQIg!16s%2Fg%2F1tfm4dr8?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    { label: "?? Nakazaya ", url: "https://slowlifeinokinawa.com/okifood-nakazaya/" },
    { label: "?? 機場美食 ", url: "https://www.naha-airport.co.jp/zh-hant/spend/shop_and_restaurant/search/?type=%E3%83%AC%E3%82%B9%E3%83%88%E3%83%A9%E3%83%B3&category=&type_airport=%E5%9B%BD%E9%9A%9B%E7%B7%9A&floor=" },  
    ],
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "13:45–14:15（30分）",
    title: "租車公司??機場",
    category: "交通",
    note: "還車+接駁到機場",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "14:15–16:55（2小時40分）",
    title: "那霸機場",
    category: "交通",
    note: "尖峰時段最好保留2:30",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 · 1/12",
    time: "16:55–17:35（40分鐘 時差1小時）",
    title: "那霸機場??桃機T1",
    category: "交通",
    note: "AirAsia FD231\n手提7kg*3 託運20kg*3",
    cost: "",
    link: "",
  },
{
    day: "info",
    label: "info",
    time: "",
    title: "??入境審查",
    category: "",
    note: "外國旅客可使用「預先入關」制度，需事先完成VJW登入",
    cost: "",
    link: [
    { label: "入境審查", url: "https://waysim.net/blogs/news/visit-japan-web?utm_source=google&utm_medium=cpc&utm_campaign=pmax&utm_content=jp_new&gad_source=1&gad_campaignid=20807295096&gbraid=0AAAAApC3qt69XSO4ar9ADVzhhMbuwFUBf&gclid=Cj0KCQiA6Y7KBhCkARIsAOxhqtPq03Q3bn0GC4TIVDEViTfYbF-jf0MKSvBrN30dFm-nirz_c5POHPQaAombEALw_wcB" },
    ],
  },
  {
    day: "info",
    label: "info",
    time: "",
    title: "??伴手禮",
    category: "",
    note: "那霸機場「國內線」的2樓為購物樓層，網羅了種類豐富的沖繩名產",
    cost: "",
    link: [
    { label: "伴手禮介紹", url: "https://tc.tabirai.net/sightseeing/article/okinawa-gift-summary/" },
    { label: "限定名產", url: "https://tc.tabirai.net/sightseeing/article/okinawa-limited-snacks/" },
    ],
  },
    {
    day: "info",
    label: "info",
    time: "",
    title: "???COUPON",
    category: "",
    note: "AEON, Bic Camera, 唐吉軻德, 松本清, 大國藥妝, sundrug ",
    cost: "",
    link: [
    { label: "AEON北谷", url: "https://world.aeon-ryukyu.jp/tc/shopping/5-off-coupon/" },
    { label: "AEON夢樂城", url: "https://tw-img.vpon.com/img/campaigns/aeon/aeon_2025campaign_tc/index.html" },
    { label: "通用 coupon", url: "https://www.letsgojp.com/coupon/1618/" },
    { label: "sundrug", url: "https://www.taxfreeshops.jp/zhtw/tieup/4" },
    ],
  },
    {
    day: "info",
    label: "info",
    time: "",
    title: "?Plan B",
    category: "",
    note: "D1 : 租車公司 -> 東南植物樂園 -> 飯店\nD2 : 飯店 -> 沖繩兒童王國 -> AEON 夢樂城午餐 -> 美國村->晚餐\nD3 : 飯店 -> 中城公園 -> 午餐:Okinawasoba-Kintarou -> 玉泉洞 -> costco -> 國際通",
    cost: "",
    link: "",
  }
];

// ===== 下面這段是你原本的 UI 程式碼（保留） =====
function normalizeUrl(raw) {
  const s = (raw || "").trim();
  if (!s) return "";
  if (/^https?:\/\//i.test(s)) return s;
  if (/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(s)) return "https://" + s;
  return "";
}

function splitLinkField(linkField) {
  if (!linkField) return [];
  if (Array.isArray(linkField)) return linkField;
  return String(linkField)
    .split(/\n|\r|,\s*/g)
    .map(p => p.trim())
    .filter(Boolean);
}

function guessIcon(url) {
  try {
    const u = new URL(url);
    const host = u.hostname.replace(/^www\./, "").toLowerCase();
    const full = (host + (u.pathname || "")).toLowerCase();
    if (full.includes("google.com/maps") || full.includes("maps.app.goo.gl") || host.includes("maps")) return "??";
    if (full.includes("booking") || full.includes("ticket") || full.includes("reserve") || full.includes("trip.com") || full.includes("klook") || full.includes("kkday")) return "???";
    return "??";
  } catch (e) {
    return "??";
  }
}

schedule.forEach(item => {
  const raw = splitLinkField(item.link);
  const links = [];

  raw.forEach(v => {
    // 1) link 是字串：當作外部網址
    if (typeof v === "string") {
      const url = normalizeUrl(v);
      if (!url) return;
      const icon = guessIcon(url);
      let host = "";
      try { host = new URL(url).hostname.replace(/^www\./,""); } catch(e) {}
      links.push({ kind: "url", label: `${icon} ${host || "連結"}`, url });
      return;
    }

    // 2) link 是物件：支援 url 或 toDay
    if (v && typeof v === "object") {
      if (v.toDay) {
        links.push({ kind: "nav", label: v.label || "前往", toDay: String(v.toDay) });
        return;
      }
      if (v.url) {
        const url = normalizeUrl(v.url);
        if (!url) return;
        links.push({ kind: "url", label: v.label || (guessIcon(url) + " 連結"), url });
        return;
      }
    }
  });

  item.links = links;
});


const days = Array.from(new Set(schedule.map(item => item.day)));
const dayMeta = {};
schedule.forEach(item => { if (!dayMeta[item.day]) dayMeta[item.day] = item.label; });

const dayTabsEl = document.getElementById("dayTabs");
const cardContainer = document.getElementById("cardContainer");
const emptyState = document.getElementById("emptyState");
const dayTitleEl = document.getElementById("dayTitle");

let currentDay = days[0] || "D1";

// ===== ? Check list（info 頁，可勾選並保存） =====
const CHECKLIST_STORAGE_KEY = "riceball_packing_checklist_v1";

// 你可以在這裡調整預設清單
const DEFAULT_CHECKLIST = [
  "【證件】護照",
  "【證件】電子入境申報單",
  "【證件】台灣駕照",
  "【證件】駕照日文譯本",
  "【證件】機票與飯店訂房資料",

  "【金融】現金",
  "【金融】信用卡",
  "【金融】零錢包",

  "【衣物】上衣 ×3",
  "【衣物】褲子 ×2～3",
  "【衣物】內衣褲 ×3",
  "【衣物】睡衣 ×1",
  "【衣物】外套",
  "【衣物】襪子 ×3",
  "【衣物】帽子",
  "【衣物】圍巾",
  "【衣物】手套",
  "【衣物】手錶",
  "【衣物】首飾",
  "【衣物】太陽眼鏡/眼鏡",

  "【盥洗】牙刷/牙膏",
  "【盥洗】洗面乳",
  "【盥洗】保養品/化妝品",
  "【盥洗】梳子",
  "【盥洗】壓縮毛巾",
  "【盥洗】刮鬍刀",
  "【盥洗】隱形眼鏡",
  
  "【醫藥】個人藥品（胃藥、退燒藥、隱疾藥）",
  "【醫藥】眼藥水",
  "【醫藥】速崩錠",

  "【電子】手機",
  "【電子】平板",
  "【電子】行動電源",
  "【電子】SIM 卡",
  "【電子】耳機",
  "【電子】萬用轉接頭",
  "【電子】延長線/充電器",
  "【電子】車用充電器",
  "【電子】充電線",
  "【電子】防丟器",
  
  "【日用】行程表 App",
  "【日用】車用手機支架",
  "【日用】摺疊傘",
  "【日用】牙線棒",
  "【日用】濕紙巾/面紙",
  "【日用】女性生理用品",
  "【日用】護唇膏",
  "【日用】護手霜",
  "【日用】口罩",
  
  "【行李整理】收納袋（衣物分類）",
  "【行李整理】行李秤",
  "【行李整理】購物袋",

  "【小孩】上衣 ×4～5",
  "【小孩】褲子 ×3～4",
  "【小孩】內衣褲 ×4～5",
  "【小孩】襪子 ×4～5",
  "【小孩】睡衣 ×2",
  "【小孩】外套 ×1",
  "【小孩】帽子 / 手套）",
  "【小孩】兒童口罩",
  "【小孩】充氣枕頭",

  "【小孩】水壺",
  "【小孩】兒童餐具",
  "【小孩】玩具",
  "【小孩】兒童相機",
  "【小孩】兒童耳機"
];

function loadChecklist() {
  try {
    const raw = localStorage.getItem(CHECKLIST_STORAGE_KEY);
    if (!raw) return DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed)) throw new Error("bad");
    return parsed
      .filter(x => x && typeof x.text === "string")
      .map(x => ({ text: x.text, done: !!x.done }));
  } catch (e) {
    return DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
  }
}

function saveChecklist(list) {
  try {
    localStorage.setItem(CHECKLIST_STORAGE_KEY, JSON.stringify(list));
  } catch (e) {}
}

let packingChecklist = loadChecklist();

function renderChecklistPanel(show) {
  const panel = document.getElementById("checklistPanel");
  if (!panel) return;

  if (!show) {
    panel.style.display = "none";
    panel.innerHTML = "";
    return;
  }

  panel.style.display = "block";

panel.innerHTML = `
  <div class="card collapsed info-card" id="packingCard">
    <div class="dot"></div>

    <div class="card-header" id="checklistHeader" style="cursor:pointer;">
      <div>
        <div class="title">? CHECK LIST</div>
      </div>
      <div class="right-top">
        
        <div class="chev" id="checklistArrow">?</div>
      </div>
    </div>

    <div class="detail" id="checklistBody">
      <div id="checklistList"></div>

      <div class="checklist-actions">
        <input id="checklistInput" class="checklist-input" placeholder="新增一個物品（例如：泳衣、拖鞋）" />
        <button id="checklistAddBtn" class="btn-link" type="button">＋新增</button>
        <button id="checklistResetBtn" class="btn-ghost" type="button">重置預設</button>
        <button id="checklistClearBtn" class="btn-danger" type="button">全部取消勾選</button>
      </div>
    </div>
  </div>
`;

  const listEl = document.getElementById("checklistList");
// ===== 收合狀態（預設縮起，並保存）=====
  const checklistBody = document.getElementById("checklistBody");
  const checklistHeader = document.getElementById("checklistHeader");
  const checklistArrow = document.getElementById("checklistArrow");

  const CHECKLIST_OPEN_KEY = "riceball_packing_checklist_open_v1";
  let checklistOpen = localStorage.getItem(CHECKLIST_OPEN_KEY) === "true"; // 預設 false = 縮起

const packingCard = document.getElementById("packingCard");

function updateChecklistCollapse() {
  if (!packingCard) return;
  if (checklistOpen) {
    packingCard.classList.remove("collapsed");
    if (checklistArrow) checklistArrow.textContent = "?";
  } else {
    packingCard.classList.add("collapsed");
    if (checklistArrow) checklistArrow.textContent = "?";
  }
}
  if (checklistHeader) {
    checklistHeader.addEventListener("click", () => {
      checklistOpen = !checklistOpen;
      localStorage.setItem(CHECKLIST_OPEN_KEY, String(checklistOpen));
      updateChecklistCollapse();
    });
  }

  updateChecklistCollapse();


  
  function redrawList() {
    listEl.innerHTML = "";
    packingChecklist.forEach((item, idx) => {
      const row = document.createElement("div");
      row.className = "checklist-row";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!item.done;
      cb.addEventListener("change", () => {
        packingChecklist[idx].done = cb.checked;
        saveChecklist(packingChecklist);
      });

      const label = document.createElement("label");
      label.textContent = item.text;

      const del = document.createElement("button");
      del.className = "btn-ghost";
      del.type = "button";
      del.textContent = "刪除";
      del.addEventListener("click", (e) => {
        e.stopPropagation();
        packingChecklist.splice(idx, 1);
        saveChecklist(packingChecklist);
        redrawList();
      });

      row.appendChild(cb);
      row.appendChild(label);
      row.appendChild(del);
      listEl.appendChild(row);
    });
  }

  redrawList();

  const input = document.getElementById("checklistInput");
  const addBtn = document.getElementById("checklistAddBtn");
  const resetBtn = document.getElementById("checklistResetBtn");
  const clearBtn = document.getElementById("checklistClearBtn");

  function addItem() {
    const v = (input.value || "").trim();
    if (!v) return;
    packingChecklist.unshift({ text: v, done: false });
    saveChecklist(packingChecklist);
    input.value = "";
    redrawList();
  }

  addBtn.addEventListener("click", addItem);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addItem();
  });

  resetBtn.addEventListener("click", () => {
    packingChecklist = DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
    saveChecklist(packingChecklist);
    renderChecklistPanel(true);
  });

  clearBtn.addEventListener("click", () => {
    packingChecklist = packingChecklist.map(x => ({ ...x, done: false }));
    saveChecklist(packingChecklist);
    renderChecklistPanel(true);
  });
}


function renderDayTabs() {
  dayTabsEl.innerHTML = "";
  days.forEach(day => {
    const btn = document.createElement("button");
    btn.className = "day-tab" + (day === currentDay ? " active" : "");
    const label = dayMeta[day] || day;
    const parts = label.split(" · ");
    const d = parts[0] || day;
    const date = parts[1] || "";
    btn.innerHTML = "<strong>" + d + "</strong><span>" + date + "</span>";
    btn.addEventListener("click", () => {
      currentDay = day;
      renderDayTabs();
      renderCards();
    });
    dayTabsEl.appendChild(btn);
  });
}

function renderCards() {
  // info 頁顯示準備物品清單
  renderChecklistPanel(currentDay === "info");
  const items = schedule.filter(item => item.day === currentDay);
  cardContainer.innerHTML = "";

  const label = dayMeta[currentDay] || currentDay;
  const parts = label.split(" · ");
  const d = parts[0] || currentDay;
  const date = parts[1] || "";
  dayTitleEl.innerHTML = d + " <span>" + date + "</span>";

  if (!items.length) {
    emptyState.style.display = "block";
    return;
  }
  emptyState.style.display = "none";

  items.forEach(item => {
    const card = document.createElement("div");
    card.className = "card collapsed info-card";

    const dot = document.createElement("div");
    dot.className = "dot";
    card.appendChild(dot);

    const header = document.createElement("div");
    header.className = "card-header";

    const left = document.createElement("div");

    const time = document.createElement("div");
    time.className = "time";
    time.textContent = item.time || "";

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = item.title || "";

    left.appendChild(time);
    left.appendChild(title);

    const right = document.createElement("div");
    right.className = "right-top";

    const chip = document.createElement("div");
    chip.className = "category-chip";
    chip.textContent = item.category || "行程";

    const chev = document.createElement("div");
    chev.className = "chev";
    chev.textContent = "?";

    right.appendChild(chip);
    right.appendChild(chev);

    header.appendChild(left);
    header.appendChild(right);

    const detail = document.createElement("div");
    detail.className = "detail";

    const note = document.createElement("div");
    note.className = "note";
    note.textContent = item.note || "";

    const footer = document.createElement("div");
    footer.className = "card-footer";

    const cost = document.createElement("div");
    cost.className = "cost";
    cost.textContent = item.cost || "";

    const linkWrap = document.createElement("div");
    linkWrap.className = "link-wrap";

    if (Array.isArray(item.links) && item.links.length) {
      item.links.forEach(l => {
        const btn = document.createElement("button");
        btn.className = "btn-link";
        btn.textContent = l.label || "連結";
btn.addEventListener("click", (e) => {
  e.stopPropagation();

  // 內部分頁跳轉
  if (l.kind === "nav" && l.toDay) {
    currentDay = l.toDay;
    renderDayTabs();
    renderCards();

    // 可選：切到頂部（手機體感比較好）
    window.scrollTo({ top: 0, behavior: "smooth" });
    return;
  }

  // 外部連結
  if (l.kind === "url" && l.url) {
    window.open(l.url, "_blank");
  }
});

        linkWrap.appendChild(btn);
      });
    } else {
      const btn = document.createElement("button");
      btn.className = "btn-link";
      btn.textContent = "無連結";
      btn.disabled = true;
      linkWrap.appendChild(btn);
    }

    footer.appendChild(cost);
    footer.appendChild(linkWrap);

    detail.appendChild(note);
    detail.appendChild(footer);

    card.appendChild(header);
    card.appendChild(detail);

    card.addEventListener("click", () => {
      card.classList.toggle("collapsed");
    });

    cardContainer.appendChild(card);
  });
}

renderDayTabs();
renderCards();

// ===== ? 這裡開始是「新增/更新」的 PWA 安裝邏輯 =====
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js").catch(() => {});
  });
}

let deferredPrompt = null;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  if (installBtn) installBtn.hidden = false;
});

if (installBtn) {
  installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) return;

    installBtn.disabled = true;
    try {
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
    } catch (e) {}

    deferredPrompt = null;
    installBtn.hidden = true;
    installBtn.disabled = false;
  });
}

window.addEventListener("appinstalled", () => {
  deferredPrompt = null;
  if (installBtn) installBtn.hidden = true;
});

const isStandalone =
  window.matchMedia("(display-mode: standalone)").matches ||
  window.navigator.standalone === true;

if (isStandalone && installBtn) installBtn.hidden = true;
  </script>
</body>
</html>






















