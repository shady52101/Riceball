<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Okinawa Trip Planner</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#f06292" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Okinawa Trip" />

  <style>
    :root {
      --primary: #ec407a;
      --primary-dark: #d81b60;
      --bg: #fef4f8;
      --card-bg: #ffffff;
      --text-main: #212121;
      --text-sub: #757575;
      --radius-xl: 18px;
      --shadow-soft: 0 10px 24px rgba(233, 30, 99, 0.18);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffe3f0 0, #fef4f8 45%, #ffffff 100%);
      color: var(--text-main);
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 18px 20px 14px;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: white;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 6px 18px rgba(233, 30, 99, 0.35);
      border-radius: 0 0 24px 24px;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.04em;
    }
    header .subtitle {
      font-size: 13px;
      opacity: 0.92;
      margin-top: 4px;
    }
    .day-tabs-wrap {
      padding: 10px 16px 4px;
      position: sticky;
      top: 72px;
      z-index: 9;
    }
    .day-tabs {
      display: flex;
      gap: 8px;
      background: rgba(255,255,255,0.9);
      padding: 6px;
      border-radius: 999px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
    }
    .day-tab {
      flex: 1;
      padding: 8px 0;
      border-radius: 999px;
      border: 0;
      background: transparent;
      color: var(--primary-dark);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }
    .day-tab span { display: block; font-size: 11px; opacity: 0.8; }
    .day-tab strong { display: block; font-size: 13px; }
    .day-tab.active {
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(233, 30, 99, 0.55);
    }
    main { flex: 1; padding: 16px 14px 32px; }
    .day-title {
      font-size: 15px;
      font-weight: 600;
      margin: 4px 4px 10px;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .day-title span { font-size: 12px; opacity: 0.9; }
    .timeline { position: relative; margin-left: 10px; padding-left: 12px; }
    .timeline::before {
      content: "";
      position: absolute;
      left: 4px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, rgba(236,64,122,0.1), rgba(236,64,122,0.35));
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }
    .card::before {
      content: "";
      position: absolute;
      left: -40px;
      top: -40px;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: radial-gradient(circle at center, rgba(236,64,122,0.18), transparent 65%);
      opacity: 0.7;
    }
    .dot {
      position: absolute;
      left: -18px;
      top: 16px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 2px solid #ffffff;
      background: var(--primary);
      box-shadow: 0 0 0 4px rgba(236,64,122,0.25);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }
    .time { font-size: 11px; color: var(--text-sub); margin-bottom: 4px; }
    .title { font-size: 15px; font-weight: 700; margin-bottom: 2px; }
    .right-top { display:flex; align-items:center; gap:8px; }
    .category-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(236,64,122,0.06);
      color: var(--primary-dark);
      border: 1px solid rgba(236,64,122,0.25);
      margin-top: 2px;
      white-space: nowrap;
    }
    .chev {
      font-size: 14px;
      color: rgba(216,27,96,0.75);
      transition: transform 0.18s ease;
    }
    .card.collapsed .chev { transform: rotate(-90deg); }
    .detail { margin-top: 10px; }
    .card.collapsed .detail { display: none; }
    .note {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 8px;
      line-height: 1.5;
      white-space: pre-line;
    }
    .card-footer {
      display: flex;
      align-items: center;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-sub);
      gap: 8px;
      flex-wrap: wrap;
    }
    .cost { font-weight: 500; margin-right: auto; white-space: pre-line; }
    .link-wrap { display: flex; gap: 8px; flex-wrap: wrap; }
    .btn-link {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 0;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(233,30,99,0.35);
      white-space: nowrap;
    }
    .btn-link:disabled {
      opacity: 0.4;
      box-shadow: none;
      cursor: default;
      background: #e0e0e0;
      color: #757575;
    }
    .empty {
      text-align: center;
      color: var(--text-sub);
      margin-top: 40px;
      font-size: 14px;
    }

    /* âœ… PWA å®‰è£æŒ‰éˆ•ï¼ˆAndroid Chromeï¼‰ */
    .install-btn {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 9999;
      padding: 12px 14px;
      border-radius: 999px;
      border: 0;
      background: linear-gradient(135deg, #ec407a, #ff80ab);
      color: #ffffff;
      font-weight: 800;
      box-shadow: 0 10px 24px rgba(233, 30, 99, 0.28);
      cursor: pointer;
      white-space: nowrap;
    }
    .install-btn[hidden] { display: none; }
    .install-btn:disabled { opacity: 0.55; cursor: default; }
  
    /* âœ… æº–å‚™ç‰©å“æ¸…å–®ï¼ˆinfoé ï¼‰ */
    .checklist-panel { margin: 8px 4px 14px; }
    .checklist-card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
    }
    .checklist-title { font-size: 15px; font-weight: 800; margin: 0 0 8px; }
    .checklist-sub { font-size: 12px; color: var(--text-sub); margin-bottom: 10px; line-height: 1.35; }
    .checklist-row { display:flex; align-items:center; gap:10px; padding: 8px 0; border-top: 1px solid rgba(0,0,0,0.06); }
    .checklist-row:first-of-type { border-top: 0; }
    .checklist-row label { flex: 1; font-size: 13px; }
    .checklist-actions { display:flex; gap:8px; flex-wrap: wrap; margin-top: 10px; }
    .checklist-input { flex: 1; min-width: 180px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.12); outline: none; }
    .btn-ghost {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(236,64,122,0.35);
      background: rgba(236,64,122,0.06);
      color: var(--primary-dark);
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-ghost:active { transform: translateY(1px); }
    .btn-danger {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(244,67,54,0.35);
      background: rgba(244,67,54,0.06);
      color: #c62828;
      cursor: pointer;
      white-space: nowrap;
    }

  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Okinawa Trip</h1>
      <div class="subtitle">æ²–ç¹©è¡è¡è¡</div>
    </header>

    <div class="day-tabs-wrap">
      <div class="day-tabs" id="dayTabs"></div>
    </div>

    <main>
      <div class="day-title" id="dayTitle"></div>
      <div class="checklist-panel" id="checklistPanel" style="display:none;"></div>
      <div class="timeline" id="cardContainer"></div>
      <div class="empty" id="emptyState" style="display:none;">é€™ä¸€å¤©é‚„æ²’æœ‰å®‰æ’è¡Œç¨‹</div>
    </main>
  </div>

  <!-- âœ… å®‰è£æŒ‰éˆ•ï¼ˆå¯å®‰è£æ™‚æ‰æœƒé¡¯ç¤ºï¼‰ -->
  <button id="installBtn" class="install-btn" hidden>â¬‡ï¸ å®‰è£ App</button>

  <script>
/**
 * âœ… é€£çµè‡ªç”±å‘½åè¦å‰‡ï¼ˆä½ åªè¦æ”¹é€™è£¡ï¼‰
 * link å¯ä»¥æ˜¯ï¼š
 * 1) å­—ä¸²ï¼ˆå¯ç”¨ \\n æ”¾å¤šå€‹ç¶²å€ï¼‰=> æœƒè‡ªå‹•ç”¢ç”Ÿã€Œicon + ç¶²ç«™åã€
 * 2) é™£åˆ— [{ label, url }, ...] => ä½ çµ¦ä»€éº¼åå­—å°±é¡¯ç¤ºä»€éº¼åå­—ï¼ˆicon ä½ ä¹Ÿå¯ä»¥è‡ªå·±å¯«é€² labelï¼‰
 */
const schedule = [
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "13:25â€“15:55ï¼ˆ2å°æ™‚30åˆ† æ™‚å·®1å°æ™‚ï¼‰",
    title: "æ¡ƒæ©ŸT1â¡ï¸é‚£éœ¸æ©Ÿå ´",
    category: "äº¤é€š",
    note: "AirAsia FD230\næ‰‹æ7kg*3 è¨—é‹20kg*2\nåœ‹éš›ç·š4Fæˆ–æ˜¯åœ‹å…§ç·š1Fæœ‰è±¬è‚‰è›‹é£¯ç³°",
    cost: "å·²ä»˜ 18,262 NTD (ä¾†å›)",
    link: [
      { label: "âœˆï¸ Visit Japan Web", url: "https://services.digital.go.jp/zh-cmn-hant/visit-japan-web/" },
      { label: "ğŸ™ è±¬è‚‰è›‹é£¯ç³°ä»‹ç´¹", url: "https://hanblog.tw/porktamago/" }
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "15:55â€“17:55ï¼ˆ2å°æ™‚ï¼‰",
    title: "é‚£éœ¸æ©Ÿå ´â¡ï¸ç§Ÿè»Šå…¬å¸",
    category: "äº¤é€š",
    note: "å…¥å¢ƒå¯©æŸ¥ + ç§Ÿè»Šå…¬å¸æ¥é€ + ç§Ÿè»Š\nè¡Œè…³ç§Ÿè»Š (Pin code : 63512871)",
    cost: "æœªä»˜ 18.090å††\nå·²ä»˜  2,010å††",
    link: [
      { label: "ğŸšŒ æ¥é§è»Šä½ç½®", url: "https://youtube.com/watch?v=iAl8v1AAcjM&embeds_referring_euri=https%3A%2F%2Ffootprint-rentacar.com%2F&source_ve_path=OTY3MTQ/" },
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "17:55â€“18:25ï¼ˆ30åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "ç§Ÿè»Šå…¬å¸ -> æ¼å¸«é£Ÿå ‚ å¤§ã¯ã‚™ã‚“ãµã‚™ã‚‹èˆ ã•ã‹ãªå¤§çµ±",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Okinawaangya+Car+Rental,+3+Chome-8-11+Kanagusuku,+Naha,+Okinawa+901-0155%E6%97%A5%E6%9C%AC/Ryoshi+Shokudo+Obanburumai+Sakana+Daitoryo,+3+Chome-1-17+Minatomachi,+Naha,+Okinawa+900-0001%E6%97%A5%E6%9C%AC/@26.2267077,127.7007522,13.42z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e569dca4935975:0xf7655eeca9dc26ba!2m2!1d127.6621154!2d26.2011231!1m5!1m1!1s0x34e56b047c4b65c9:0x3e70d1280ee22c7a!2m2!1d127.6803223!2d26.2436476!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "18:25â€“19:25ï¼ˆ1å°æ™‚ï¼‰",
    title: "æ™šé¤",
    category: "ç”¨é¤",
    note: "æ¼å¸«é£Ÿå ‚ å¤§ã¯ã‚™ã‚“ãµã‚™ã‚‹èˆ ã•ã‹ãªå¤§çµ±\nå¤§ä»½é‡ä¸¼é£¯/é°»é­šé£¯",
    cost: "",
    link: [
      { label: "ğŸ£ é¤å»³ä»‹ç´¹", url: "https://plumpyblog.com/ryoshi-shokudo/" },
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "19:25â€“20:05ï¼ˆ40åˆ†ï¼‰",
    title: " â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ™šé¤ -> sunset beach hotel (å«æ—©é¤)",
    cost: "å·²ä»˜ 4,420 NTD",
    link: [
      { label: "ğŸ›ï¸ é£¯åº—", url: "https://beachmonpa.co.jp/" },
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Ryoshi+Shokudo+Obanburumai+Sakana+Daitoryo,+3+Chome-1-17+Minatomachi,+Naha,+Okinawa+900-0001%E6%97%A5%E6%9C%AC/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/@26.2790994,127.6809087,13z/data=!3m2!4b1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m14!4m13!1m5!1m1!1s0x34e56b047c4b65c9:0x3e70d1280ee22c7a!2m2!1d127.6803223!2d26.2436476!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "20:05â€“21:25ï¼ˆ1å°æ™‚20åˆ†ï¼‰",
    title: "é£¯åº— checkin + ç¾åœ‹æ‘é€›è¡—",
    category: "è³¼ç‰©",
    note: "",
    cost: "",
    link: [
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥1", url: "https://www.gltjp.com/zh-hant/article/item/21095/" },
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥2", url: "https://bobbyfun.tw/2024-01-08-2709/" },
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥3", url: "https://okinawa.letsgojp.com/archives/11334/" },
    ],
  },
  {
    day: "D1",
    label: "D1 Â· 1/9",
    time: "21:25â€“22:55ï¼ˆ1å°æ™‚30åˆ†ï¼‰",
    title: "AEON åŒ—è°·",
    category: "è³¼ç‰©",
    note: "åª½åª½æ™‚é–“\nè¶…å¸‚åˆ° 23:00 å•†åº—åˆ°22:00",
    cost: "",
     link: [
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥", url: "https://bobowin.blog/aeon-american/" },
    ],
  }, 
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "08:30â€“09:00ï¼ˆ30åˆ†ï¼‰",
    title: "é£¯åº—",
    category: "ç”¨é¤",
    note: "é£¯åº—æ—©é¤",
    cost: "",
    link: [
      { label: "ğŸ›ï¸ é£¯åº—", url: "https://beachmonpa.co.jp/" },
      ],
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "09:00â€“09:30ï¼ˆ30åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "é£¯åº— -> æ²–ç¹©å…’ç«¥ç‹åœ‹",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Goya,+5+Chome%E2%88%927+%E6%B2%96%E7%B9%A9%E5%85%92%E7%AB%A5%E7%8E%8B%E5%9C%8B/@26.316697,127.7690274,15z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e512738000a60d:0x8be494fd3bd9ee0b!2m2!1d127.80304!2d26.327691!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "09:30â€“12:30ï¼ˆ3å°æ™‚ï¼‰",
    title: "æ²–ç¹©å…’ç«¥ç‹åœ‹",
    category: "æ™¯é»",
    note: "å¹³æ—¥ç‡Ÿæ¥­æ™‚é–“ : 9:30-17:30\nå‡æ—¥ç‡Ÿæ¥­æ™‚é–“ : 9:30-21:00",
    cost: "æœªä»˜ æˆäºº 1,000å†† / å°å­© free",
    link: [
      { label: "ğŸŒ´ å…’ç«¥ç‹åœ‹", url: "https://www.okzm.jp/information-cht/" },
      ],
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "12:30â€“13:00ï¼ˆ30åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ²–ç¹©å…’ç«¥ç‹åœ‹ -> ç¾åœ‹æ‘",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Goya,+5+Chome%E2%88%927+%E6%B2%96%E7%B9%A9%E5%85%92%E7%AB%A5%E7%8E%8B%E5%9C%8B/@26.316697,127.7690274,15z/data=!3m1!5s0x34e569b7a599cbfd:0x91d234b6c3aa40f1!4m15!4m14!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e512738000a60d:0x8be494fd3bd9ee0b!2m2!1d127.80304!2d26.327691!3e0!5i1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },

  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "13:00â€“14:30ï¼ˆ1å°æ™‚30åˆ†ï¼‰",
    title: "ç¾åœ‹æ‘åˆé¤",
    category: "ç”¨é¤",
    note: "AI æ¨è–¦ :  ã‚¹ãƒ†ãƒ¼ã‚­ãƒã‚¦ã‚¹å››å­£ï¼ˆSunabeï¼‰-éµæ¿ç‰›æ’\nAI æ¨è–¦ :  é³¥ã¨åµã®å°‚é–€åº— é³¥ç‰ï¼ˆåŒ—è°·åº—ï¼‰- è¦ªå­ä¸¼ã€ç‰å­ç‡’ã€å’–å“©\nAI æ¨è–¦ :  ã‚„ã£ã±ã‚Šã‚¹ãƒ†ãƒ¼ã‚­ï¼ˆç¾åœ‹æ‘) - ç¾å¼é¤å»³",
    cost: "",
    link: [
      { label: "ğŸ½ï¸ ç¾é£Ÿæ¨è–¦", url: "https://tw.tabiiro.travel/gourmet/article/americanvillage-gourmet/" },
    ]
  },

  
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "14:30â€“16:30ï¼ˆ2å°æ™‚ï¼‰",
    title: "é£¯åº—ä¼‘æ¯",
    category: "ä¼‘æ¯",
    note: "å……é›»æ™‚é–“/åª½åª½è‡ªç”±æ™‚é–“",
    cost: "",
    link: "",
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "16:30â€“17:10ï¼ˆ40åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "é£¯åº— -> æ±å—æ¤ç‰©æ¨‚åœ’",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+8-11+Mihama,+Chatan,+Nakagami+District,+Okinawa+904-0115%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Chibana,+%E6%9D%B1%E5%8D%97%E6%A4%8D%E7%89%A9%E6%A8%82%E5%9C%92/@26.3421377,127.7550494,13.5z/data=!4m14!4m13!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e511d8db9268d7:0x97aa9da99ec7390b!2m2!1d127.8065709!2d26.3755374!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "17:10â€“19:40ï¼ˆ2å°æ™‚30åˆ†ï¼‰",
    title: "æ±å—æ¤ç‰©æ¨‚åœ’",
    category: "æ™¯é»",
    note: "ç‡ˆå…‰ç§€ï¼Œå¤œé–“ç¥¨17:00~22:00 \n(ç•¶å¤©æœ‰æ—¥æœ¬æˆäººç¯€æ´»å‹•ï¼Œç´°ç¯€æœªçŸ¥)",
    cost: "æœªä»˜ æˆäºº 2500å††/å°å­© 900å††",
    link: [
    { label: "ğŸ† æ™¯é»è³‡è¨Š", url: "https://www.southeast-botanical.jp/tw/illumination/" },
    ]
  },
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "19:40â€“20:20ï¼ˆ40åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ±å—æ¤ç‰©æ¨‚åœ’ -> ç¾åœ‹æ‘",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+8-11+Mihama,+Chatan,+Nakagami+District,+Okinawa+904-0115%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%B2%96%E7%B9%A9%E5%B8%82+Chibana,+%E6%9D%B1%E5%8D%97%E6%A4%8D%E7%89%A9%E6%A8%82%E5%9C%92/@26.3421377,127.7550494,13.5z/data=!4m14!4m13!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e511d8db9268d7:0x97aa9da99ec7390b!2m2!1d127.8065709!2d26.3755374!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  
  {
    day: "D2",
    label: "D2 Â· 1/10",
    time: "20:20â€“21:30ï¼ˆ1å°æ™‚10åˆ†ï¼‰",
    title: "ç¾åœ‹æ‘æ™šé¤",
    category: "ç”¨é¤",
    note: "JUMBO STEAK HAN'S (æœ‰å…©é–“åº—) \n æˆ–æ˜¯ç‡’è‚‰(éœ€æå‰é è¨‚)",
    cost: "",
    link: [
    { label: "ğŸ¥© ç¾é£Ÿä»‹ç´¹", url: "https://choyce.tw/steak-hans-house/" },
    ]
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "08:30â€“09:30ï¼ˆ1å°æ™‚ï¼‰",
    title: "é£¯åº—",
    category: "ç”¨é¤",
    note: "é£¯åº—æ—©é¤ + check out",
    cost: "",
    link: "",
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "09:30â€“10:00ï¼ˆ30åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "é£¯åº— -> æ°¸æ—ºå¤¢æ¨‚åŸ",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Sunset+Beach+Hotel,+Mihama,+%E5%8C%97%E8%B0%B7%E7%94%BA%E6%B2%96%E7%B9%A9%E7%B8%A3%E6%97%A5%E6%9C%AC/AEON+MALL+Okinawa+Rycom,+1%E7%95%AA%E5%9C%B0+Raikamu,+Kitanakagusuku,+Nakagami+District,+Okinawa+901-2306%E6%97%A5%E6%9C%AC/@26.2980708,127.7892839,14.21z/data=!4m14!4m13!1m5!1m1!1s0x34e5131000bf5917:0xfd9aa7dd159e858c!2m2!1d127.7556197!2d26.3147997!1m5!1m1!1s0x34e5126214d2f427:0xcb2e803176e4f16b!2m2!1d127.7966025!2d26.3137504!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "10:00â€“13:00ï¼ˆ3å°æ™‚ï¼‰",
    title: "æ°¸æ—ºå¤¢æ¨‚åŸ",
    category: "è³¼ç‰© + ç”¨é¤",
    note: "",
    cost: "",
     link: [
    { label: "ğŸ›ï¸ å•†å ´è³‡è¨Š", url: "https://tw.aeonmall.global/mall/okinawarycom/food-drink/" },
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥", url: "https://bobbyfun.tw/2024-01-07-2699/" },
    { label: "ğŸ  å…’ç«¥è¨­æ–½", url: "https://boysmom.life/2017-08-24-117/" },     
     ],
  }, 
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "13:00â€“13:50ï¼ˆ50åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ°¸æ—ºå¤¢æ¨‚åŸ-> æ²–ç¹©ä¸–ç•Œ(ç‰æ³‰æ´)\nå°å¼Ÿç¡è¦ºæ™‚é–“",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/AEON+MALL+Okinawa+Rycom,+1%E7%95%AA%E5%9C%B0+Raikamu,+Kitanakagusuku,+Nakagami+District,+Okinawa+901-2306%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E5%8D%97%E5%9F%8E%E5%B8%82+Tamagusuku,+Maekawa+%E7%8E%89%E6%B3%89%E6%B4%9E/@26.2276119,127.6791699,12z/data=!3m1!4b1!4m14!4m13!1m5!1m1!1s0x34e5126214d2f427:0xcb2e803176e4f16b!2m2!1d127.7966025!2d26.3137504!1m5!1m1!1s0x34e56985519f786b:0x5e9a8bdcd64306dd!2m2!1d127.7494344!2d26.1403423!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "13:50â€“16:50ï¼ˆ3å°æ™‚ï¼‰",
    title: "æ²–ç¹©ä¸–ç•Œ(ç‰æ³‰æ´)",
    category: "æ™¯é»",
    note: "å¤ªé¼“è¡¨æ¼”ã€‹(1)10:30 (2)12:30 (3)14:30\næ¯’è›‡è¡¨æ¼” (1)11:30 (2)13:30 (3)15:30\nè¾£æ¤’ç²‰å¿…è²·",
    cost: "æœªä»˜ æˆäºº 2,000å††, å°å­© 1,000å††",
        link: [
      { label: "ğŸ¶ æ²–ç¹©ä¸–ç•Œ", url: "https://www.google.com/search?q=%E6%B2%96%E7%B9%A9%E4%B8%96%E7%95%8C+%E7%8E%89%E6%B3%89%E6%B4%9E" },
    ]
  },
    {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "16:50â€“17:00ï¼ˆ10åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ²–ç¹©ä¸–ç•Œ(ç‰æ³‰æ´) -> costco",
    cost: "",
    link: [
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Okinawasoba-Kintarou,+%E3%81%B5%E3%81%AA%E3%81%93%E3%81%97%E3%82%A2%E3%83%91%E3%83%BC%E3%83%88+Funakoshi-1197+Tamagusuku,+Nanjo,+Okinawa+901-0618%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E5%8D%97%E5%9F%8E%E5%B8%82+Tsukishiro,+Kakinohana+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97/@26.1500059,127.7631814,15z/data=!3m1!4b1!4m14!4m13!1m5!1m1!1s0x34e56f12041e81c3:0xb1f12121b0b040c5!2m2!1d127.755329!2d26.1489297!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "17:00â€“18:30ï¼ˆ1å°æ™‚30åˆ†ï¼‰",
    title: "COSTCO",
    category: "é€›è¡—",
    note: "åªèƒ½ç¾é‡‘æˆ–æ˜¯master card\nä¸èƒ½é€€ç¨…",
    cost: "",
    link: [
      { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥", url: "https://www.funliday.com/posts/okinawa-costco/" },
    ],
  },
    {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "18:30â€“19:30ï¼ˆ1å°æ™‚ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "COSTCO -> åœ‹éš›é€šå¤§å’ŒROYNETé…’åº—\né£¯åº—ä»˜è²»åœè»Šå ´ï¼Œå…ˆåˆ°å…ˆè´\næ˜ŸæœŸæ—¥ 12:00~18:00 åœ‹éš›é€šæ­¥è¡Œè€…å¤©åœ‹",
    cost: "",
    link: [
      { label: "ğŸ›ï¸ é£¯åº—", url: "https://www.daiwaroynet.jp/ct/naha-kokusaidori/" },
      { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E9%82%A3%E9%9C%B8%E5%B8%82+Asato,+2+Chome%E2%88%921+%E9%82%A3%E9%9C%B8%E5%9C%8B%E9%9A%9B%E9%80%9A%E5%A4%A7%E5%92%8CROYNET%E9%A3%AF%E5%BA%97/%E6%97%A5%E6%9C%AC%E3%80%92901-0601+Okinawa,+Nanjo,+Tsukishiro,+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97+IC%E5%8D%97%E5%9C%9F%E5%9C%B0%E5%8C%BA%E7%94%BB%E6%95%B4%E7%90%86%E4%BA%8B%E6%A5%AD%E5%9C%B0%E5%86%851%E8%A1%97%E5%8C%BA1/@26.1663933,127.7473131,14.29z/data=!4m14!4m13!1m5!1m1!1s0x34e5696484d555e5:0xa8fda093394851cc!2m2!1d127.6936214!2d26.2176311!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ]
  },
  {
    day: "D3",
    label: "D3 Â· 1/11",
    time: "19:30â€“21:30ï¼ˆ2å°æ™‚ï¼‰",
    title: "é£¯åº—check in +åœ‹éš›é€šé€›è¡—+æ™šé¤",
    category: "ç”¨é¤",
    note: "åœ‹éš›é€šå¤§å’ŒROYNETé…’åº—\næ—©é¤è¦åŠ è³¼322 NTD/äººï¼Œå…’ç«¥å…è²»\nAIæ¨è–¦ : èŠ±ç¬ é£Ÿå ‚ - å®¶åº­å¼æ–™ç†\nAIæ¨è–¦ : ä¸‰ç¬ é£Ÿå ‚ï¼ˆ24 å°æ™‚) - åœ¨åœ°é¤å»³",
    cost: "å·²ä»˜ 4.227 NTD",
    link: [
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥1", url: "https://bobbyfun.tw/2024-01-08-2708/" },
    { label: "ğŸ›ï¸ é€›è¡—æ”»ç•¥2", url: "https://tc.tabirai.net/sightseeing/article/kokusai-street-shopping//" },
    { label: "ğŸœ ç¾é£Ÿæ¨è–¦1", url: "https://www.youtube.com/watch?v=RyfCLurnJNA/" },
    { label: "ğŸœ ç¾é£Ÿæ¨è–¦2", url: "https://www.wendyjourney.com/kokusai-dori-food/" },
    ],
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "08:30â€“09:30ï¼ˆ1å°æ™‚ï¼‰",
    title: "æ—©é¤ + é£¯åº—check out",
    category: "ç”¨é¤",
    note: "é£¯åº—æ—©é¤è¦åŠ è³¼",
    cost: "æœªä»˜ å¤§äºº 1,980 å††\nå…’ç«¥ å…è²»",    
    link: "",
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "09:30â€“09:45ï¼ˆ15åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "é£¯åº— > æ³¢ä¸Šå®®",
    cost: "",
    link: [
    { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E6%B2%96%E7%B9%A9%E7%B8%A3%E9%82%A3%E9%9C%B8%E5%B8%82+Asato,+2+Chome%E2%88%921+%E9%82%A3%E9%9C%B8%E5%9C%8B%E9%9A%9B%E9%80%9A%E5%A4%A7%E5%92%8CROYNET%E9%A3%AF%E5%BA%97/%E6%97%A5%E6%9C%AC%E3%80%92901-0601+Okinawa,+Nanjo,+Tsukishiro,+COSTCO%E5%A5%BD%E5%B8%82%E5%A4%9A+%E6%B2%96%E7%B9%A9%E5%BA%97+IC%E5%8D%97%E5%9C%9F%E5%9C%B0%E5%8C%BA%E7%94%BB%E6%95%B4%E7%90%86%E4%BA%8B%E6%A5%AD%E5%9C%B0%E5%86%851%E8%A1%97%E5%8C%BA1/@26.1663933,127.7473131,14.29z/data=!4m14!4m13!1m5!1m1!1s0x34e5696484d555e5:0xa8fda093394851cc!2m2!1d127.6936214!2d26.2176311!1m5!1m1!1s0x34e56f002d5171dd:0x6f86b1ebb56a155c!2m2!1d127.7866429!2d26.1552838!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "09:45â€“10:45ï¼ˆ1å°æ™‚ï¼‰",
    title: "æ³¢ä¸Šå®®",
    category: "æ™¯é»",
    note: "",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "10:45â€“11:00ï¼ˆ15åˆ†ï¼‰",
    title: "â¬‡ï¸",
    category: "äº¤é€š",
    note: "æ³¢ä¸Šå®® > é‚£éœ¸æ¸¯ (æµ·ä¸Šè§€å…‰èˆ¹Orcaè™Ÿ)",
    cost: "",
     link: [
    { label: "ğŸš— google map", url: "https://www.google.com/maps/dir/Naminouegusanpaishasenyo+Parking+Lot,+1+Chome-25-10+Wakasa,+Naha,+Okinawa+900-0031%E6%97%A5%E6%9C%AC/Naha+Port+Parking+Lot,+3-2-1+Tondocho,+Naha,+Okinawa+900-0035%E6%97%A5%E6%9C%AC/@26.2156047,127.6652209,16z/data=!3m2!4b1!5s0x34e5696490700691:0x765739d498290581!4m14!4m13!1m5!1m1!1s0x34e569006a4d5495:0xb1be8b57693545a5!2m2!1d127.6712424!2d26.220213!1m5!1m1!1s0x34e56976c5e233f5:0x44e7ba90416bdbc0!2m2!1d127.6703948!2d26.2109788!3e0?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    ],
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "11:00â€“12:30ï¼ˆ1å°æ™‚30åˆ†ï¼‰",
    title: "æµ·ä¸Šè§€å…‰èˆ¹Orcaè™Ÿ",
    category: "æ™¯é»",
    note: "11:30 è§€å…‰èˆ¹\nå°šæœªé ç´„",
    cost: "ä¸å«é¤ : å¤§äºº 2,200, å°å­©å…è²» \n å«é¤ : å¤§äºº 4,500, å°å­© 500",
    link: [
    { label: "ğŸ›ï¸ æ™¯é»ä»‹ç´¹", url: "https://fullfenblog.tw/glass-bottom-boat/" },
    { label: "ğŸœ é ç´„ç¶²ç«™", url: "https://tw.westmarine.co.jp/orca_lunch.php" },
    ],
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "12:30â€“13:45ï¼ˆ1å°æ™‚15åˆ†ï¼‰",
    title: "åˆé¤ + ç§Ÿè»Šå…¬å¸é‚„è»Š",
    category: "ç”¨é¤",
    note: "é‚„è»Šå‰è¦åŠ æ»¿æ²¹\né¸æ“‡ä¸€ : è§€å…‰èˆ¹æµ·é®®ä¸¼åƒåˆ°é£½æ–¹æ¡ˆ(å°å­©æ˜¯å¥—é¤)\né¸æ“‡äºŒ : Nakazaya ãªã‹ã–å®¶æ²–ç¹©éºµ(ç§Ÿè»Šå…¬å¸æ­¥è¡Œ4åˆ†é˜ï¼Œè¡Œæå¯„æ”¾ç§Ÿè»Šå…¬å¸?)\né¸æ“‡ä¸‰ : æ©Ÿå ´ç¾é£Ÿ",
    link: [
    { label: "â›½ åŠ æ²¹ç«™", url: "https://www.google.com/maps/place/apollostation+Oroku+Kinjo+SS/@26.201515,127.6616106,18.25z/data=!4m10!1m2!2m1!1z5Yqg5rK556uZ!3m6!1s0x34e569b79ed74589:0xae0f20014db85b03!8m2!3d26.2018544!4d127.6622261!15sCgnliqDmsrnnq5laDCIK5Yqg5rK5IOermZIBC2dhc19zdGF0aW9umgEjQ2haRFNVaE5NRzluUzBWSlEwRm5TVU4yT0dGNVkxaDNFQUXgAQD6AQUIogEQIg!16s%2Fg%2F1tfm4dr8?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3MUgBUAM%3D/" },
    { label: "ğŸœ Nakazaya ", url: "https://slowlifeinokinawa.com/okifood-nakazaya/" },
    { label: "ğŸ¥© æ©Ÿå ´ç¾é£Ÿ ", url: "https://www.naha-airport.co.jp/zh-hant/spend/shop_and_restaurant/search/?type=%E3%83%AC%E3%82%B9%E3%83%88%E3%83%A9%E3%83%B3&category=&type_airport=%E5%9B%BD%E9%9A%9B%E7%B7%9A&floor=" },  
    ],
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "13:45â€“14:15ï¼ˆ30åˆ†ï¼‰",
    title: "ç§Ÿè»Šå…¬å¸â¡ï¸æ©Ÿå ´",
    category: "äº¤é€š",
    note: "é‚„è»Š+æ¥é§åˆ°æ©Ÿå ´",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "14:15â€“16:55ï¼ˆ2å°æ™‚40åˆ†ï¼‰",
    title: "é‚£éœ¸æ©Ÿå ´",
    category: "äº¤é€š",
    note: "å°–å³°æ™‚æ®µæœ€å¥½ä¿ç•™2:30",
    cost: "",
    link: "",
  },
  {
    day: "D4",
    label: "D4 Â· 1/12",
    time: "16:55â€“17:35ï¼ˆ40åˆ†é˜ æ™‚å·®1å°æ™‚ï¼‰",
    title: "é‚£éœ¸æ©Ÿå ´â¡ï¸æ¡ƒæ©ŸT1",
    category: "äº¤é€š",
    note: "AirAsia FD231\næ‰‹æ7kg*3 è¨—é‹20kg*3",
    cost: "",
    link: "",
  },
{
    day: "info",
    label: "info",
    time: "",
    title: "ä¼´æ‰‹ç¦®",
    category: "ğŸ",
    note: "é‚£éœ¸æ©Ÿå ´ã€Œåœ‹å…§ç·šã€çš„2æ¨“ç‚ºè³¼ç‰©æ¨“å±¤ï¼Œç¶²ç¾…äº†ç¨®é¡è±å¯Œçš„æ²–ç¹©åç”¢",
    cost: "",
    link: [
    { label: "ä¼´æ‰‹ç¦®ä»‹ç´¹", url: "https://tc.tabirai.net/sightseeing/article/okinawa-gift-summary/" },
    { label: "é™å®šåç”¢", url: "https://tc.tabirai.net/sightseeing/article/okinawa-limited-snacks/" },
    ],
  },

];

// ===== ä¸‹é¢é€™æ®µæ˜¯ä½ åŸæœ¬çš„ UI ç¨‹å¼ç¢¼ï¼ˆä¿ç•™ï¼‰ =====
function normalizeUrl(raw) {
  const s = (raw || "").trim();
  if (!s) return "";
  if (/^https?:\/\//i.test(s)) return s;
  if (/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(s)) return "https://" + s;
  return "";
}

function splitLinkField(linkField) {
  if (!linkField) return [];
  if (Array.isArray(linkField)) return linkField;
  return String(linkField)
    .split(/\n|\r|,\s*/g)
    .map(p => p.trim())
    .filter(Boolean);
}

function guessIcon(url) {
  try {
    const u = new URL(url);
    const host = u.hostname.replace(/^www\./, "").toLowerCase();
    const full = (host + (u.pathname || "")).toLowerCase();
    if (full.includes("google.com/maps") || full.includes("maps.app.goo.gl") || host.includes("maps")) return "ğŸ“";
    if (full.includes("booking") || full.includes("ticket") || full.includes("reserve") || full.includes("trip.com") || full.includes("klook") || full.includes("kkday")) return "ğŸŸï¸";
    return "ğŸŒ";
  } catch (e) {
    return "ğŸŒ";
  }
}

schedule.forEach(item => {
  const raw = splitLinkField(item.link);
  const links = [];
  raw.forEach(v => {
    if (typeof v === "string") {
      const url = normalizeUrl(v);
      if (!url) return;
      const icon = guessIcon(url);
      let host = "";
      try { host = new URL(url).hostname.replace(/^www\./,""); } catch(e) {}
      links.push({ label: `${icon} ${host || "é€£çµ"}`, url });
    } else if (v && v.url) {
      const url = normalizeUrl(v.url);
      if (!url) return;
      links.push({ label: v.label || (guessIcon(url) + " é€£çµ"), url });
    }
  });
  item.links = links;
});

const days = Array.from(new Set(schedule.map(item => item.day)));
const dayMeta = {};
schedule.forEach(item => { if (!dayMeta[item.day]) dayMeta[item.day] = item.label; });

const dayTabsEl = document.getElementById("dayTabs");
const cardContainer = document.getElementById("cardContainer");
const emptyState = document.getElementById("emptyState");
const dayTitleEl = document.getElementById("dayTitle");

let currentDay = days[0] || "D1";

// ===== âœ… æº–å‚™ç‰©å“æ¸…å–®ï¼ˆinfo é ï¼Œå¯å‹¾é¸ä¸¦ä¿å­˜ï¼‰ =====
const CHECKLIST_STORAGE_KEY = "riceball_packing_checklist_v1";

// ä½ å¯ä»¥åœ¨é€™è£¡èª¿æ•´é è¨­æ¸…å–®
const DEFAULT_CHECKLIST = [
  "è­·ç…§ / è­‰ä»¶ / é§•ç…§ï¼ˆå«åœ‹éš›é§•ç…§è‹¥éœ€è¦ï¼‰",
  "æ©Ÿç¥¨ / è¨‚æˆ¿è³‡è¨Šï¼ˆæˆªåœ–å‚™ä»½ï¼‰",
  "ä¿¡ç”¨å¡ / ç¾é‡‘ / é›¶éŒ¢åŒ…",
  "æ‰‹æ©Ÿ / å……é›»å™¨ / è¡Œå‹•é›»æº / å……é›»ç·š",
  "ç¶²å¡ / Wiâ€‘Fi / è½‰æ¥é ­",
  "å¸¸å‚™è—¥ï¼ˆè…¸èƒƒã€æ­¢ç—›ã€éæ•ï¼‰/ OKç¹ƒ",
  "é˜²æ›¬ / å¸½å­ / å¤ªé™½çœ¼é¡",
  "é›¨å‚˜ / è–„å¤–å¥—",
  "æ›æ´—è¡£ç‰© / å…§è¡£è¤² / è¥ªå­",
  "ç›¥æ´—ç”¨å“ï¼ˆç‰™åˆ·ç‰™è†ã€åˆ®é¬åˆ€ç­‰ï¼‰",
  "å°å­©ç”¨å“ï¼ˆå°¿å¸ƒ/æ¿•ç´™å·¾/æ›¿æ›è¡£/é›¶é£Ÿï¼‰"
];

function loadChecklist() {
  try {
    const raw = localStorage.getItem(CHECKLIST_STORAGE_KEY);
    if (!raw) return DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed)) throw new Error("bad");
    return parsed
      .filter(x => x && typeof x.text === "string")
      .map(x => ({ text: x.text, done: !!x.done }));
  } catch (e) {
    return DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
  }
}

function saveChecklist(list) {
  try {
    localStorage.setItem(CHECKLIST_STORAGE_KEY, JSON.stringify(list));
  } catch (e) {}
}

let packingChecklist = loadChecklist();

function renderChecklistPanel(show) {
  const panel = document.getElementById("checklistPanel");
  if (!panel) return;

  if (!show) {
    panel.style.display = "none";
    panel.innerHTML = "";
    return;
  }

  panel.style.display = "block";
  panel.innerHTML = `
    <div class="checklist-card">
      <div class="checklist-title">âœ… æº–å‚™ç‰©å“æ¸…å–®</div>
      <div class="checklist-sub">å‹¾é¸ç‹€æ…‹æœƒè‡ªå‹•ä¿å­˜ï¼ˆå­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼‰ã€‚æ›æ‰‹æ©Ÿ/æ¸…é™¤ç¶²ç«™è³‡æ–™æœƒé‡ç½®ã€‚</div>
      <div id="checklistList"></div>
      <div class="checklist-actions">
        <input id="checklistInput" class="checklist-input" placeholder="æ–°å¢ä¸€å€‹ç‰©å“ï¼ˆä¾‹å¦‚ï¼šæ³³è¡£ã€æ‹–é‹ï¼‰" />
        <button id="checklistAddBtn" class="btn-link" type="button">ï¼‹æ–°å¢</button>
        <button id="checklistResetBtn" class="btn-ghost" type="button">é‡ç½®é è¨­</button>
        <button id="checklistClearBtn" class="btn-danger" type="button">å…¨éƒ¨å–æ¶ˆå‹¾é¸</button>
      </div>
    </div>
  `;

  const listEl = document.getElementById("checklistList");

  function redrawList() {
    listEl.innerHTML = "";
    packingChecklist.forEach((item, idx) => {
      const row = document.createElement("div");
      row.className = "checklist-row";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!item.done;
      cb.addEventListener("change", () => {
        packingChecklist[idx].done = cb.checked;
        saveChecklist(packingChecklist);
      });

      const label = document.createElement("label");
      label.textContent = item.text;

      const del = document.createElement("button");
      del.className = "btn-ghost";
      del.type = "button";
      del.textContent = "åˆªé™¤";
      del.addEventListener("click", (e) => {
        e.stopPropagation();
        packingChecklist.splice(idx, 1);
        saveChecklist(packingChecklist);
        redrawList();
      });

      row.appendChild(cb);
      row.appendChild(label);
      row.appendChild(del);
      listEl.appendChild(row);
    });
  }

  redrawList();

  const input = document.getElementById("checklistInput");
  const addBtn = document.getElementById("checklistAddBtn");
  const resetBtn = document.getElementById("checklistResetBtn");
  const clearBtn = document.getElementById("checklistClearBtn");

  function addItem() {
    const v = (input.value || "").trim();
    if (!v) return;
    packingChecklist.unshift({ text: v, done: false });
    saveChecklist(packingChecklist);
    input.value = "";
    redrawList();
  }

  addBtn.addEventListener("click", addItem);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addItem();
  });

  resetBtn.addEventListener("click", () => {
    packingChecklist = DEFAULT_CHECKLIST.map(t => ({ text: t, done: false }));
    saveChecklist(packingChecklist);
    renderChecklistPanel(true);
  });

  clearBtn.addEventListener("click", () => {
    packingChecklist = packingChecklist.map(x => ({ ...x, done: false }));
    saveChecklist(packingChecklist);
    renderChecklistPanel(true);
  });
}


function renderDayTabs() {
  dayTabsEl.innerHTML = "";
  days.forEach(day => {
    const btn = document.createElement("button");
    btn.className = "day-tab" + (day === currentDay ? " active" : "");
    const label = dayMeta[day] || day;
    const parts = label.split(" Â· ");
    const d = parts[0] || day;
    const date = parts[1] || "";
    btn.innerHTML = "<strong>" + d + "</strong><span>" + date + "</span>";
    btn.addEventListener("click", () => {
      currentDay = day;
      renderDayTabs();
      renderCards();
    });
    dayTabsEl.appendChild(btn);
  });
}

function renderCards() {
  // info é é¡¯ç¤ºæº–å‚™ç‰©å“æ¸…å–®
  renderChecklistPanel(currentDay === "info");
  const items = schedule.filter(item => item.day === currentDay);
  cardContainer.innerHTML = "";

  const label = dayMeta[currentDay] || currentDay;
  const parts = label.split(" Â· ");
  const d = parts[0] || currentDay;
  const date = parts[1] || "";
  dayTitleEl.innerHTML = d + " <span>" + date + "</span>";

  if (!items.length) {
    emptyState.style.display = "block";
    return;
  }
  emptyState.style.display = "none";

  items.forEach(item => {
    const card = document.createElement("div");
    card.className = "card collapsed";

    const dot = document.createElement("div");
    dot.className = "dot";
    card.appendChild(dot);

    const header = document.createElement("div");
    header.className = "card-header";

    const left = document.createElement("div");

    const time = document.createElement("div");
    time.className = "time";
    time.textContent = item.time || "";

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = item.title || "";

    left.appendChild(time);
    left.appendChild(title);

    const right = document.createElement("div");
    right.className = "right-top";

    const chip = document.createElement("div");
    chip.className = "category-chip";
    chip.textContent = item.category || "è¡Œç¨‹";

    const chev = document.createElement("div");
    chev.className = "chev";
    chev.textContent = "â–¾";

    right.appendChild(chip);
    right.appendChild(chev);

    header.appendChild(left);
    header.appendChild(right);

    const detail = document.createElement("div");
    detail.className = "detail";

    const note = document.createElement("div");
    note.className = "note";
    note.textContent = item.note || "";

    const footer = document.createElement("div");
    footer.className = "card-footer";

    const cost = document.createElement("div");
    cost.className = "cost";
    cost.textContent = item.cost || "";

    const linkWrap = document.createElement("div");
    linkWrap.className = "link-wrap";

    if (Array.isArray(item.links) && item.links.length) {
      item.links.forEach(l => {
        const btn = document.createElement("button");
        btn.className = "btn-link";
        btn.textContent = l.label || "é€£çµ";
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          window.open(l.url, "_blank");
        });
        linkWrap.appendChild(btn);
      });
    } else {
      const btn = document.createElement("button");
      btn.className = "btn-link";
      btn.textContent = "ç„¡é€£çµ";
      btn.disabled = true;
      linkWrap.appendChild(btn);
    }

    footer.appendChild(cost);
    footer.appendChild(linkWrap);

    detail.appendChild(note);
    detail.appendChild(footer);

    card.appendChild(header);
    card.appendChild(detail);

    card.addEventListener("click", () => {
      card.classList.toggle("collapsed");
    });

    cardContainer.appendChild(card);
  });
}

renderDayTabs();
renderCards();

// ===== âœ… é€™è£¡é–‹å§‹æ˜¯ã€Œæ–°å¢/æ›´æ–°ã€çš„ PWA å®‰è£é‚è¼¯ =====
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js").catch(() => {});
  });
}

let deferredPrompt = null;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  if (installBtn) installBtn.hidden = false;
});

if (installBtn) {
  installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) return;

    installBtn.disabled = true;
    try {
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
    } catch (e) {}

    deferredPrompt = null;
    installBtn.hidden = true;
    installBtn.disabled = false;
  });
}

window.addEventListener("appinstalled", () => {
  deferredPrompt = null;
  if (installBtn) installBtn.hidden = true;
});

const isStandalone =
  window.matchMedia("(display-mode: standalone)").matches ||
  window.navigator.standalone === true;

if (isStandalone && installBtn) installBtn.hidden = true;
  </script>
</body>
</html>
